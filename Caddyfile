:80 {
    # Enable HTTP/2 (default in Caddy)
    # Root directory for static files
    root * /usr/share/caddy/html
    
    # Gzip compression
    encode gzip
    
    # Cache static assets
    @static {
        file
        path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2
    }
    header @static Cache-Control "public, max-age=31536000, immutable"
    
    # API Proxy with HTTP/2 to backend
    handle /api/* {
        reverse_proxy http://backend:3001 {
            # Caddy will automatically use HTTP/2 if backend supports it
            # This prevents HTTP desync attacks by using HTTP/2's binary protocol
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }
    
    # SPA routing - serve index.html for all other routes
    handle {
        try_files {path} /index.html
        file_server
    }
}
